

// tests for getAnimals
// Generated by serverless-mocha-plugin

const mochaPlugin = require('serverless-mocha-plugin');
const nock = require('nock');

const { expect } = mochaPlugin.chai;
const wrapped = mochaPlugin.getWrapper('getAnimals', '/handler.js', 'getAnimals');

const apiEndpoint = nock('https://apigateway.test.lifeworks.com/rescue-shelter-api');

const mockEndpoints = () => {
  const cats = apiEndpoint.get('/cats').reply(200);
  const dogs = apiEndpoint.get('/dogs').reply(200);
  const hamsters = apiEndpoint.get('/hamsters').reply(200);
  return { cats, dogs, hamsters };
};

describe('getAnimals', () => {
  before((done) => {
    nock.disableNetConnect();
    done();
  });

  it('Loads animals online', () => {
    mockEndpoints();
    return wrapped.run({}).then(() =>
      expect(apiEndpoint.isDone()).to.be.true);
  });

  it('Responds with HTTP OK', () => {
    mockEndpoints();
    return wrapped.run({}).then((response) => {
      expect(response.statusCode).to.be.equal(200);
    });
  });
});
